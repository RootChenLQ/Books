# 案例15：水文-水动力耦合模拟

## 系统示意图（AI自动生成）

<table>
<tr>
<td width="58%">
<img src="case_15_hydro_dynamic_coupling_ai_diagram.png" alt="案例15：水文-水动力耦合模拟系统示意图" width="100%"/>
</td>
<td width="42%">

**AI大模型总结要点**

- 📖 案例简介：本案例展示**水文模型与水动力模型的耦合计算**，实现从降雨产流到河道洪水演进的全过程模拟，是分布式水文建模的重要扩展。
- 🌊 水文-水动力耦合原理：耦合流程
- 💻 代码实现：核心模块
- 📊 运行结果：典型输出

> 该图由AI图像生成引擎根据案例描述自动创建，呈现输入条件、物理模型、控制策略与关键指标之间的关系，可作为阅读正文前的快速导览。

</td>
</tr>
</table>



**难度**: ⭐⭐⭐⭐  
**标签**: `耦合模拟` `Saint-Venant` `水文-水动力` `端到端`

---

## 📖 案例简介

本案例展示**水文模型与水动力模型的耦合计算**，实现从降雨产流到河道洪水演进的全过程模拟，是分布式水文建模的重要扩展。

### 🎯 学习目标

1. 理解水文-水动力耦合的意义
2. 掌握Saint-Venant方程基础
3. 学会模型接口设计
4. 实现完整耦合模拟流程

### 🔑 关键技术

- **Saint-Venant方程**：一维明渠非恒定流
- **模型耦合**：水文→水动力
- **单位转换**：径流深→流量
- **数值稳定性**：Muskingum-Cunge格式

---

## 🌊 水文-水动力耦合原理

### 1. 耦合流程

```python
┌──────────────────┐
│   降雨输入       │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  水文模型        │
│  (新安江)        │
│  产流计算        │
└────────┬─────────┘
         │ 径流深(mm)
         ▼
┌──────────────────┐
│  接口转换        │
│  径流→流量       │
└────────┬─────────┘
         │ 流量(m³/s)
         ▼
┌──────────────────┐
│  水动力模型      │
│  (Saint-Venant)  │
│  河道演进        │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  水位-流量过程   │
└──────────────────┘
```

### 2. Saint-Venant方程

**连续方程**:
```python
∂A/∂t + ∂Q/∂x = 0
```

**动量方程**:
```python
∂Q/∂t + ∂(Q²/A)/∂x + gA∂h/∂x = -gASf
```

其中:
- A: 过水断面面积 (m²)
- Q: 流量 (m³/s)
- h: 水深 (m)
- Sf: 摩阻坡度
- g: 重力加速度

**摩阻坡度** (曼宁公式):
```python
Sf = n²Q² / (A²R^(4/3))
```

### 3. 数值格式

采用**Muskingum-Cunge方法**（简化版）:

**流量演算**:
```python
# Muskingum参数
K = dx / c          # 时间参数
X = 0.25            # 权重参数

# 演算系数
C0 = (-K*X + 0.5*dt) / (K - K*X + 0.5*dt)
C1 = (K*X + 0.5*dt) / (K - K*X + 0.5*dt)
C2 = (K - K*X - 0.5*dt) / (K - K*X + 0.5*dt)

# 流量更新
Q[i] = C0*Q[i-1] + C1*Q_new[i-1] + C2*Q_old[i]
```python

**水深更新**:
```python
# 曼宁公式反算
h = (Q*n / (B*S0^0.5))^(3/5)
```python

### 4. 单位转换

**径流深 → 流量**:
```python
volume = runoff(mm) * 1e-3 * area(km²) * 1e6  # m³
discharge = volume / dt  # m³/s
```python

---

## 💻 代码实现

### 核心模块

#### 1. Saint-Venant求解器

```python
class SaintVenant1D:
    def __init__(self, L, dx, dt, n, B, S0):
        self.L = L      # 河段长度
        self.dx = dx    # 空间步长
        self.dt = dt    # 时间步长
        self.n = n      # 曼宁糙率
        self.B = B      # 河道宽度
        self.S0 = S0    # 河床坡度
        
    def solve_step(self, Q_upstream):
        """求解一个时间步"""
        # Muskingum-Cunge演算
        for i in range(1, self.nx):
            K = self.dx / c
            X = 0.25
            # 计算C0, C1, C2...
            Q_new[i] = C0*Q[i-1] + C1*Q_new[i-1] + C2*Q[i]
        
        # 更新水深
        h_new[i] = (Q*n / (B*S0^0.5))^(3/5)
        
        return h_new, Q_new
```python

#### 2. 耦合接口

```python
def couple_simulation(rainfall, evaporation, 
                     hydro_params, hydraulic_params):
    # 1. 水文模型
    xaj = XinAnJiangModel(hydro_params)
    runoff = xaj.run(rainfall, evaporation)['R']
    
    # 2. 转换流量
    discharge = runoff * area / dt
    
    # 3. 水动力模型
    results = solve_saint_venant(
        Q_upstream=discharge,
        ...
    )
    
    return results
```python

---

## 📊 运行结果

### 典型输出

```
======================================================================
案例15：水文-水动力耦合模拟
======================================================================

【水文模拟】
  总降雨: 372.2 mm
  总径流: 199.3 mm
  径流系数: 0.535
  峰值径流: 16.83 mm/h
  峰值流量: 573.4 m³/s

【水动力模拟】
  河段长度: 2000 m
  网格点数: 21
  时间步数: 43200
  最大水深: 7.22 m
  最大流量: 573.4 m³/s
  最大流速: 19.11 m/s

【出口断面】
  峰值流量: 571.8 m³/s
  峰值水深: 7.21 m
  平均水深: 0.35 m
```python

### 可视化结果

生成6幅子图：
1. **降雨-径流过程** - 水文模拟
2. **流域出流流量** - 接口转换
3. **出口断面流量** - 水动力模拟
4. **水深沿程分布** - 空间分布
5. **水深时空分布** - 时空演化

---

## 🎓 技术总结

### 1. 耦合要点

| 环节 | 方法 | 关键参数 |
|------|------|---------|
| 水文模型 | 新安江 | 14个参数 |
| 单位转换 | 径流→流量 | 面积、时间步 |
| 水动力模型 | Saint-Venant | n, B, S0 |
| 时间同步 | 插值 | dt_hydro, dt_hydraulic |

### 2. 数值稳定性

**Courant条件**:
```
Cr = c * dt / dx < 1
```

**稳定性保证**:
- 限制系数范围
- 阻尼更新
- 最小值约束

### 3. 模型对比

| 特性 | 水文模型 | 水动力模型 |
|------|---------|-----------|
| 时间步 | 小时级 | 分钟-秒级 |
| 空间尺度 | 流域 | 河段 |
| 输出 | 径流深 | 水位-流量 |
| 适用 | 产汇流 | 河道演进 |

---

## 🔬 工程应用

### 1. 洪水预报

**应用场景**:
- 实时洪水预报
- 洪水风险评估
- 预警系统

### 2. 水库调度

**耦合扩展**:
- 上游：流域水文
- 中游：水库调度
- 下游：河道洪水

### 3. 防洪规划

**应用方向**:
- 堤防设计
- 河道整治
- 蓄滞洪区

---

## 📝 参考资料

1. **Saint-Venant方程**
   - Chaudhry, M.H., 2008, "Open-Channel Flow"
   - 槐文信，2007，《明渠水力学》

2. **水文-水动力耦合**
   - Beven, K., 2012, "Rainfall-Runoff Modelling"
   - Liu, Z. et al., 2019, "Coupled hydrological-hydraulic modeling"

3. **数值方法**
   - Cunge, J.A., 1969, "On the Muskingum-Cunge method"
   - Preissmann, A., 1961, "Numerical schemes"

---

## 💡 练习建议

1. **基础练习**
   - 修改河道参数（n, B, S0）
   - 改变流域面积
   - 调整时间步长

2. **进阶练习**
   - 实现完整隐式格式
   - 添加横向入流
   - 多河段串联

3. **综合应用**
   - 真实流域案例
   - 实时洪水预报
   - 水库-河道联合调度

---

**作者**: CHS-Books项目组  
**日期**: 2025-11-02  
**版本**: v1.0
